\section{Evaluating Depth-Based Tiebreaking}
\label{sec:depth-based-evaluation}
We evaluated our depth-based diversifying tiebreaking strategies against standard
tiebreaking strategies.
In addition to the 35 IPC benchmark domains with 1104 instances used in
the previous set of experiments, we used 28 zerocost domains with 620
instances.

\subsection{Evaluating Depth-Based Tiebreaking with $h$-tiebreaking}

We compared the performance of standard tiebreaking methods to
depth-based tiebreaking methods. These all use $h$ as the first-level
tiebreaking and either \fifo, \lifo or \ro (random order) as the
last-resort tiebreaking.

Experiments are conducted on \textbf{1104 standard IPC benchmark
instances} and \textbf{620 zerocost instances}.  Each experiment uses
either \lmcut heuristics or \mands heuristics.  For \mands heuristics,
we used the settings recommended by Fast Downward website
(bisimulation-based shrink strategy, DFP merge strategy and exact label
reduction). Each experiment is run for 5 minutes excluding SAS
translation time, with 4GB memory constraints.

We first show the summary results of these experiments (\reftbl{tbl:depth-summary}).
Overall, depth-based tiebreaking tends to show larger coverages than the
standard tiebreaking strategies. 
In the following, we describe the
details of each experiments.

\begin{table}[htb]
 {
 \centering
 \setlength{\tabcolsep}{3pt}
 \input{tables/7-1-summary.tex}
 \caption{
 Main summary results: Coverage comparison (number of instances solved in 5min, 4GB, \lmcut/\mands
 heuristics) between standard tiebreaking and depth-based tiebreaking
 ($\depth$). When \lmcut is used, $\depth$ outperforms standard strategies both in IPC
 instances (1104 problems total) and Zerocost instances (620 problems
 total). When \mands is used, $\depth$ outperforms standard strategies
 in Zerocost instances. \textbf{Bold} shows the best configuration.}
 \label{tbl:depth-summary}
 }
\end{table}

\reftbl{tbl:lmcut-ipc-full} shows the number of \textbf{1104 standard
IPC benchmark instances} solved by \lmcut heuristics with various
tiebreaking strategies, under 5min, 4GB experiments. We highlight the
best results when the difference between the maximum and the minimum
coverage exceeds 2.  Depth-based tiebreaking ($\depth$) shows
impressive results on Openstacks and Cybersec domains because these
domains contain many instances of zero-cost edges and the final plateau
$\plateau{f,h}$ is huge (See \refig{fig:plateau}).  Most other instances
are unaffected by depth-based tiebreaking.  Thus, our method offers a
better performance in the domains of interest for free, i.e. without
losing performance in other domains.

\begin{table}[htbp]
 {
 \centering
 \setlength{\tabcolsep}{0.1em}
 \input{tables/7-ipc-lmcut}
 % \input{tables/aaai16-robustnesscheck/aaai16prelim3/1-depth.tex}
 \caption{
 Coverage comparison (the number of instances solved in 5min, 4GB, LMcut
 heuristics) on \textbf{1104 standard IPC benchmark instances}. We highlight the
 best results when the difference between the maximum and the minimum coverage exceeds 2.
 }
 \label{tbl:lmcut-ipc-full}
 }
\end{table}


\reftbl{tbl:mands-ipc-full} shows the results by \mands heuristics on \textbf{1104 standard
IPC benchmark instances}.
In this configuration, depth-based tiebreaking negatively affects the performance.
As we show in \reftbl{tbl:expansion-ratio}, this is because
the low-level overhead of depth-based tiebreaking decreases the high
node processing speed of \mands. Evaluation of \mands heuristics is
very efficiently implemented as a table lookup, and it is able to
evaluate an order of magnitude larger number of nodes
compared to \lmcut heuristics. Thus, even the slightest overhead caused
by the management of depth buckets has affected the performance.

\begin{table}[htb]
 \centering
 \begin{tabular}{cccc}
  nodes/sec                  & LMcut      & M\&S       & M\&S slowdown\\
  \hline
  $[f,h,\lifo]$              & 8.86$\times 10^3$ & 1.37$\times 10^5$ & 100\%\\
  $[f,h,\depth,\lifo]$ & 9.37$\times 10^3$ & 1.13$\times 10^5$ & 82\%\\
  \hline
  $[f,h,\fifo]$              & 9.65$\times 10^3$ & 1.41$\times 10^5$ & 100\%\\
  $[f,h,\depth,\fifo]$ & 9.62$\times 10^3$ & 1.24$\times 10^5$ & 87\%\\
  \hline
 \end{tabular}
 \caption{Comparison of the average node expansion ratio (node/sec) between
 standard tiebreaking and depth-based tiebreaking on \lmcut and \mands
 heuristics. Numbers are averaged over the problem instances solved by
 all 4 configurations. Since the node evaluation of \mands is an order of
 magnitude faster than \lmcut, the overhead of managing depth-based
 tiebreaking queue is non-negligible on \mands.}
 \label{tbl:expansion-ratio}
\end{table}

\begin{table}[htbp]
 {
 \centering
 \setlength{\tabcolsep}{0.1em}
 \input{tables/7-ipc-mands}
 % \input{tables/aaai16-robustnesscheck-mands/aaai16prelim3/1-depth.tex}
 \caption{
 Coverage comparison (the number of instances solved in 5min, 4GB, M\&S
 heuristics) on \textbf{1104 standard IPC benchmark instances}. We highlight the
 best results when the difference between the maximum and the minimum coverage exceeds 2.
 }
 \label{tbl:mands-ipc-full}
 }
\end{table}

% \reftbl{tbl:mands-evaluations} shows that if we instead compare the
% number of evaluations on problems solved by both, depth-based
% tiebreaking significantly outperforms the standard tiebreaking
% strategies. Moreover, in the next \textbf{zerocost} domain experiments,
% depth-based tiebreaking ourperforms the standard tiebreaking
% overall. Besides, the coverages by \mands is less than that of \lmcut.

% \begin{figure}[htb]
%  \centering
%  \caption{
%  Comparison of the total number of nodes generated
%  by \mands heuristics until
%  the goal is found, with vs without depth-based tiebreaking.
%  } \label{tbl:mands-evaluations}
% \end{figure}

In contrast, 
in zerocost domains, our proposed method outperforms the traditional
tiebreaking methods in both \lmcut and \mands heuristics
(\reftbl{tbl:lmcut-zerocost-full} and \reftbl{tbl:mands-zerocost-full}).
Significant improvements were observed in X domains when using \lmcut,
and in X domains when using \mands.
This means that the search efficiency offered by depth based diversification
become much more important, and the overhead caused
by the management of depth buckets become negligible even in the case of \mands.
Interestingly, When $\depth$ is enabled, \fifo tends to perform better
than \lifo in
zerocost domains in both \lmcut and \mands heuristics (299 vs 279, 317
vs 303). Also, \ro (random order) outperforms both \fifo and \lifo.

\begin{table}[htbp]
 {
 \centering
 \setlength{\tabcolsep}{0.1em}
 \input{tables/7-zero-lmcut}
 % \input{tables/aaai16-robustnesscheck/zerocost/1-depth.tex}
 \caption{
 Coverage comparison (the number of instances solved in 5min, 4GB, \lmcut heuristics) 
 on \textbf{620 zerocost instances}. We highlight the
 best results when the difference between the maximum and the minimum coverage exceeds 2.
 }
 \label{tbl:lmcut-zerocost-full}
 }
\end{table}

\begin{table}[htbp]
 {
 \centering
 \setlength{\tabcolsep}{0.1em}
 \input{tables/7-zero-mands}
 % \input{tables/aaai16-robustnesscheck-mands/zerocost/1-depth.tex}
 \caption{
 Coverage comparison (the number of instances solved in 5min, 4GB, \mands heuristics)
 on \textbf{620 zerocost instances}. We highlight the
 best results when the difference between the maximum and the minimum coverage exceeds 2.
 }
 \label{tbl:mands-zerocost-full}
 }
\end{table}

\subsection{Search Behavior Within a Plateau}

To understand the behavior of depth-based policies, we plotted the
histogram of the depths of search nodes opened by several tiebreaking
strategies in the final plateau $\plateau{f^*,0}$ until the solution is
found.  We plotted the most successful depth-based strategy,
$[f,h,\depth,\fifo]$, as well as the standard strategies $[f,h,\fifo]$,
$[f,h,\lifo]$ and a single run of randomized strategy $[f,h,\ro]$.
We additionally computed the depth metric for non-depth strategies and
recorded the results. Thus this experiment is independent from the
previous experiments for performance comparison which should not incur
this overhead.


\refig{fig:depth-histogram} to \refig{fig:depth-histogram3} show the results on several exemplar instances in
various zerocost domains.  We do not show some domains when we did not observe any depths more than 3, which means
the depth metric has negligible effect on the search performance.

In many domains, we observed that the depth-first behavior of
$[f,h,\lifo]$ results in deeper search, missing the key branch at
intermediate depths.  On the other hand, the breadth-first behavior of
$[f,h,\fifo]$ often gets stuck spending an excessive amount of time
searching around the plateau entrance.  Also, due to the large bias of
the number of nodes to the shallower depths, global randomization
$[f,h,\ro]$ showed a distribution similar to $[f,h,\fifo]$.
In contrast, $[f,h,\depth,\ro]$ is balancing the search at various depths, which
results in successfully solving more problems.

Moreover, the results suggest that in many domains the distribution follows
$D-d$, a theoretical formula which was made under the simplified
assumption that the plateau forms a tree of fixed width. In these
figures, $D$ means the largest depth in the open list, which is equal to
the number of iterations that was ever happened.

The discrepancy from the theoretical results can happen due to the
following factors: First, the branching factor of the graph may not be
uniform across the search space. Second, some depth buckets could be
exhausted, as is depicted in the line by $[f,h,\fifo]$ which
shows all nodes in the shallower depths are expanded and the line can be below $D-d$.

Next, \refig{fig:depth-histogram4} shows the same results on standard
Openstacks and Cybersec domains.
The result in Openstacks was similar to those of the zerocost domains.
In Cybersec,
% while the depth has improved the overall performance,
we found that the performance improvement was not due to the number of nodes in $\plateau{f^*,0}$ because it was small\footnote{This does not contradict to the results in \refig{fig:plateau} because \refig{fig:plateau} uses a modified Fast Downward which continues the search until expanding all nodes in the final plateau, while in this experiment the planner immediately stops the search after the first solution. These figures have the different experimental purpose: \refig{fig:plateau} was intended to show the size of the entire final plateau, while \refig{fig:depth-histogram} to \refig{fig:depth-histogram4} was meant to show the actual search behavior. If we were to continue the search after the first solution, all tiebreaking strategies should result in the same figure.} according to the plot.
Instead, we observed a large difference in the depth distribution in $\plateau{f^*,1}$ caused by the difference of tiebreaking, which shows that the depth can also enhance the search in non-final plateaus to find the nodes in the next plateau.
Similar phenomena were observed in several domains (which are included in the figure).


\begin{figure}[htbp]
% \includegraphics{img/depth/ged-opt14-strips/p17.pdf}
\includegraphics{img/depth/depot-fuel/p07.pdf}
\includegraphics{img/depth/driverlog-fuel/p04.pdf}
\includegraphics{img/depth/elevators-up/p09.pdf}
\includegraphics{img/depth/freecell-move/p04.pdf}
\includegraphics{img/depth/gripper-move/p07.pdf}
\includegraphics{img/depth/logistics00-fuel/p016.pdf}
 \caption{(Page 1/4) Number of nodes ($y$-axis) expanded per depth ($x$-axis) in
 the final plateau with different tiebreakings. Both axes are in logarithmic scale.
 }
 \label{fig:depth-histogram}
\end{figure}

\begin{figure}[htbp]
\includegraphics{img/depth/miconic-up/p79.pdf}
\includegraphics{img/depth/pathways-fuel/p03.pdf}
\includegraphics{img/depth/pipesnt-pushstart/p06.pdf}
\includegraphics{img/depth/pipesworld-pushend/p06.pdf}
\includegraphics{img/depth/psr-small-open/p46.pdf}
\includegraphics{img/depth/rovers-fuel/p07.pdf}
 \caption{(Page 2/4) Number of nodes ($y$-axis) expanded per depth ($x$-axis) in
 the final plateau with different tiebreakings. Both axes are in logarithmic scale.
 }
 \label{fig:depth-histogram2}
\end{figure}

\begin{figure}[htbp]
\includegraphics{img/depth/scanalyzer-analyze/p04.pdf}
\includegraphics{img/depth/storage-lift/p11.pdf}
\includegraphics{img/depth/tidybot-motion/p16.pdf}
\includegraphics{img/depth/tpp-fuel/p08.pdf}
\includegraphics{img/depth/woodworking-cut/p04.pdf}
\includegraphics{img/depth/zenotravel-fuel/p07.pdf}
 \caption{(Page 3/4) Number of nodes ($y$-axis) expanded per depth ($x$-axis) in
 the final plateau with different tiebreakings. Both axes are in logarithmic scale.
 }
 \label{fig:depth-histogram3}
\end{figure}

\begin{figure}[htbp]
\includegraphics{img/depth/openstacks-opt11-strips/p07.pdf}
\includegraphics{img/depth/cybersec/p11.pdf}
\begin{center}
$\downarrow$ Plotting $\plateau{f^*,1}$ $\downarrow$
\end{center}
\includegraphics{img/depth1/cybersec/p11.pdf}
\includegraphics{img/depth1/depot-fuel/p07.pdf}
\includegraphics{img/depth1/driverlog-fuel/p04.pdf}
\includegraphics{img/depth1/zenotravel-fuel/p07.pdf}
 \caption{(Page 4/4) Depth distribution in
 the final plateau ($\plateau{f^*,0}$) and a non-final plateau ($\plateau{f^*,1}$).
 }
 \label{fig:depth-histogram4}
\end{figure}

% \begin{figure}[htbp]
% \includegraphics{img/depth1/cybersec/p11.pdf}
% \includegraphics{img/depth1/depot-fuel/p07.pdf}
% \includegraphics{img/depth1/driverlog-fuel/p04.pdf}
% % \includegraphics{img/depth1/elevators-up/p09.pdf}
% % \includegraphics{img/depth1/freecell-move/p04.pdf}
% % \includegraphics{img/depth1/gripper-move/p07.pdf}
% % \includegraphics{img/depth1/logistics00-fuel/p016.pdf}
% % \includegraphics{img/depth1/miconic-up/p79.pdf}
% % \includegraphics{img/depth1/pathways-fuel/p03.pdf}
% % \includegraphics{img/depth1/pipesnt-pushstart/p06.pdf}
% % \includegraphics{img/depth1/pipesworld-pushend/p06.pdf}
% % \includegraphics{img/depth1/psr-small-open/p46.pdf}
% % \includegraphics{img/depth1/rovers-fuel/p07.pdf}
% % \includegraphics{img/depth1/scanalyzer-analyze/p04.pdf}
% % \includegraphics{img/depth1/storage-lift/p11.pdf}
% % \includegraphics{img/depth1/tidybot-motion/p16.pdf}
% % \includegraphics{img/depth1/tpp-fuel/p08.pdf}
% % \includegraphics{img/depth1/woodworking-cut/p04.pdf}
% \includegraphics{img/depth1/zenotravel-fuel/p07.pdf}
% % \includegraphics{img/depth1/openstacks-opt11-strips/p07.pdf}
%  \caption{(Page 4/4) Number of nodes ($y$-axis) expanded per depth ($x$-axis) in
%  $\plateau{f^*,1}$ with different tiebreakings. Both axes are in logarithmic scale.
%  }
%  \label{fig:depth-histogram-h1-1}
% \end{figure}

