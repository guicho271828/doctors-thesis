\section{Evaluating Depth-Based Tiebreaking}
\label{sec:depth-based-evaluation}

% this text is mostly repeated below, so deleted this and promoted the subsection below up 1 level.
%% We evaluated our depth-based diversifying tiebreaking strategies against standard
%% tiebreaking strategies.
%% In addition to the 35 IPC benchmark domains with 1104 instances used in
%% the previous set of experiments, we used 28 zerocost domains with 620
%% instances.  

%\subsection{Evaluating Depth-Based Tiebreaking with $h$-tiebreaking}

We compared the performance of standard tiebreaking methods to depth-based tiebreaking methods. These all use $h$
as the first-level tiebreaking and either \fifo, \lifo or \ro (random order) as the default tiebreaking criterion
and the only difference is the presence of the third, depth-diversification criteria.

Experiments are conducted on \textbf{1104 standard IPC benchmark
instances} from 35 domains  and \textbf{620 zerocost instances} from 28 domains (see \refsec{sec:eval-common-strategies} and \refsec{sec:zerocost-domains} for full lists of these domains). 
Fundamental experimental setting are the same as the previous ones:
Each experiment uses Fast Downward planner using \astar search and either the \lmcut heuristic or \mands heuristic.
Each experiment is run for 5 minutes excluding SAS translation time, with 4GB memory constraints.

We first show the summary results of these experiments (\reftbl{tbl:depth-summary}).
Overall, depth-based tiebreaking tends to show larger coverages than the
standard tiebreaking strategies.

\begin{table}[htb]
 {
 \centering
 \setlength{\tabcolsep}{3pt}
 \input{tables/7-1-summary.tex}
 \caption{
 Main summary results: Coverage comparison (number of instances solved in 5min, 4GB, \lmcut/\mands
 heuristics) between standard tiebreaking and depth-based tiebreaking
 ($\depth$). When \lmcut is used, $\depth$ outperforms standard strategies both in IPC
 instances (1104 problems total) and Zerocost instances (620 problems
 total). When \mands is used, $\depth$ outperforms standard strategies
 in Zerocost instances. \textbf{Bold} shows the best configuration.}
 \label{tbl:depth-summary}
 }
\end{table}

\reftbl{tbl:lmcut-zerocost-full} and \reftbl{tbl:mands-zerocost-full} shows the number of \textbf{620 zerocost
instances} solved by \lmcut heuristics with various tiebreaking strategies, with a 5min, 4GB limit. We
highlight the best results when the difference between the best and the worst coverages is greater than 2. In these
zerocost domains, our proposed method outperforms the traditional tiebreaking methods in both \lmcut and \mands
heuristics.  Significant improvements were observed in 7 domains when using \lmcut, and in 6 domains when using
\mands.
% This means that the search efficiency offered by depth based diversification become much more important,
% and the overhead caused by the management of depth buckets become negligible even in the case of \mands.
Interestingly, When the depth diversity criterion $\depth$ is used, \fifo tends to perform better than \lifo in zerocost domains for both
\lmcut and \mands heuristics (299 vs 279 for \lmcut, 317 vs 303 for \mands). Also, \ro (random order) outperforms both \fifo and \lifo.

\begin{table}[htbp]
 {
 \centering
 \input{tables/7-zero-lmcut}
  \caption{
 Coverage comparison (the number of instances solved in 5min, 4GB, \lmcut heuristics) 
 on \textbf{620 zerocost instances}. We highlight the
 best results when the difference between the maximum and the minimum coverage exceeds 2.
 }
 \label{tbl:lmcut-zerocost-full}
 }
\end{table}

\begin{table}[htbp]
 {
 \centering
 \input{tables/7-zero-mands}
  \caption{
 Coverage comparison (the number of instances solved in 5min, 4GB, \mands heuristics)
 on \textbf{620 zerocost instances}. We highlight the
 best results when the difference between the maximum and the minimum coverage exceeds 2.
 }
 \label{tbl:mands-zerocost-full}
 }
\end{table}

\reftbl{tbl:lmcut-ipc-full} shows the number of \textbf{1104 standard IPC benchmark instances} solved by \lmcut
heuristics. Depth-based tiebreaking ($\depth$) shows impressive results on Openstacks and Cybersec domains because
these domains contain many instances of zero-cost edges and the final plateau $\plateau{f,h}$ is huge (See
\refig{fig:plateau}).  Most other instances are unaffected by depth-based tiebreaking.  Thus, depth-based tie-breaking yields
better performance in the domains with large final plateaus,  without sacrificing performance in other domains.

In contrast, \reftbl{tbl:mands-ipc-full} shows that depth-based tiebreaking negatively affects the performance of \mands when applied to 
\textbf{1104 standard IPC benchmark instances}.
% 
As shown in \refig{fig:expansion-ratio}, this is because the low-level overhead of depth-based tiebreaking (i.e., updates to the depth-based bucket data structures).
Evaluation of \mands heuristics is very efficiently implemented
as a table lookup, and it is able to evaluate an order of magnitude larger number of nodes compared to \lmcut
heuristics. Thus, even the relatively small  overhead incurred by the management of depth buckets decreases the node generation rate sufficiently to noticeably degrade performance.


\begin{figure}[htbp]
 \centering
 % \begin{tabular}{cccc}
 %  nodes/sec                  & LMcut      & M\&S       & M\&S slowdown\\
 %  \hline
 %  $[f,h,\lifo]$              & 8.86$\times 10^3$ & 1.37$\times 10^5$ & 100\%\\
 %  $[f,h,\depth,\lifo]$ & 9.37$\times 10^3$ & 1.13$\times 10^5$ & 82\%\\
 %  \hline
 %  $[f,h,\fifo]$              & 9.65$\times 10^3$ & 1.41$\times 10^5$ & 100\%\\
 %  $[f,h,\depth,\fifo]$ & 9.62$\times 10^3$ & 1.24$\times 10^5$ & 87\%\\
 %  \hline
 % \end{tabular}
 % \caption{Comparison of the average node expansion ratio (node/sec) between
 % standard tiebreaking and depth-based tiebreaking on \lmcut and \mands
 % heuristics. Numbers are averaged over the problem instances solved by
 % all 4 configurations. Since the node evaluation of \mands is an order of
 % magnitude faster than \lmcut, the overhead of managing depth-based
 % tiebreaking queue is non-negligible on \mands.}
 \includegraphics{img/node-sec/lmhiF-lmh_F.pdf}
 % \includegraphics{img/node-sec/lmhiL-lmh_L.pdf}
 \includegraphics{img/node-sec/mnhiF-mnh_F.pdf}
 % \includegraphics{img/node-sec/mnhiL-mnh_L.pdf}
 % 
 \caption{Comparison of the node evaluation ratio (node/sec) between standard tiebreaking ($y$-axis) and
 depth-based tiebreaking ($x$-axis) on \lmcut and \mands heuristics. On \mands, compared to \lmcut, node evaluation rate more often becomes
 twice as slower when depth is enabled. This is because the node evaluation of \mands is an order of
 magnitude faster than \lmcut, and the overhead of managing depth-based tiebreaking queue becomes significant. Same results were obtained with \lifo default tiebreaking. }
 % 
 \label{fig:expansion-ratio}
\end{figure}

\begin{table}[htbp]
 {
 \centering
 \input{tables/7-ipc-lmcut}
  \caption{
 Coverage comparison (the number of instances solved in 5min, 4GB, LMcut
 heuristics) on \textbf{1104 standard IPC benchmark instances}. We highlight the
 best results when the difference between the maximum and the minimum coverage exceeds 2.
 }
 \label{tbl:lmcut-ipc-full}
 }
\end{table}

\begin{table}[htbp]
 {
 \centering
 \input{tables/7-ipc-mands}
  \caption{
 Coverage comparison (the number of instances solved in 5min, 4GB, M\&S
 heuristics) on \textbf{1104 standard IPC benchmark instances}. We highlight the
 best results when the difference between the maximum and the minimum coverage exceeds 2.
 }
 \label{tbl:mands-ipc-full}
 }
\end{table}

% \reftbl{tbl:mands-evaluations} shows that if we instead compare the
% number of evaluations on problems solved by both, depth-based
% tiebreaking significantly outperforms the standard tiebreaking
% strategies. Moreover, in the next \textbf{zerocost} domain experiments,
% depth-based tiebreaking ourperforms the standard tiebreaking
% overall. Besides, the coverages by \mands is less than that of \lmcut.

% \begin{figure}[htb]
%  \centering
%  \caption{
%  Comparison of the total number of nodes generated
%  by \mands heuristics until
%  the goal is found, with vs without depth-based tiebreaking.
%  } \label{tbl:mands-evaluations}
% \end{figure}

\clearpage

\subsection{Search Behavior Within a Plateau}

To understand the behavior of depth-based policies, we plotted 
histograms of the depths of search nodes evaluated by several tiebreaking
strategies in the final plateau $\plateau{f^*,0}$ until the solution is
found.  We plotted the most successful depth-based strategy,
$[f,h,\depth,\fifo]$, as well as the standard strategies $[f,h,\fifo]$,
$[f,h,\lifo]$ and a single run of randomized strategy $[f,h,\ro]$.

In addition, we  added some instrumentation to the strategies which do not use depth-based tiebreaking ($[f,h,\fifo]$, $[f,h,\lifo]$, $[f,h,\ro]$) so that as these strategies run, the depth of each of the expanded nodes is computed (although they do not affect the search behavior).
Note that this instrumentation, which adds some runtime overhead, was \emph{not}
used in the performance comparison experiments above, and were only used for this experiment, which analyzes search behavior.


\refigs{fig:depth-histogram}{fig:depth-histogram3} show the results on several exemplar instances in
various zerocost domains.  We do not show some domains when we did not observe any depths more than 3, where
the depth metric has negligible effect on the search performance.

In many domains, we observed that the depth-first behavior of
$[f,h,\lifo]$ results in deeper search, missing the key branch at
intermediate depths.  On the other hand, the breadth-first behavior of
$[f,h,\fifo]$ often gets stuck spending an excessive amount of time
searching around the plateau entrance.  Also, due to the large bias of
the number of nodes to the shallower depths, global randomization
$[f,h,\ro]$ showed a distribution similar to $[f,h,\fifo]$.
In contrast, $[f,h,\depth,\ro]$ is balancing the search at various depths, which
results in successfully solving more problems.\todo{Instead of only general trends for unspecified domains, mentioning specific domains to add some ``color'' might make this more interesting}

Moreover, the results in \refigs{fig:depth-histogram}{fig:depth-histogram3} suggest that in many domains the distribution of $[f,h,\depth,\ro]$ follows
$D-d$, a theoretical formula which was made under the simplified
assumption that the plateau forms a tree of fixed branching factor. In these
figures, $D$ means the largest depth in the open list, which is equal to
the number of iterations that has ever happened in the depth diversification framework.\todo{refs to sec{sec:theoretical-characteristics}}

The discrepancy from the theoretical prediction can be caused by the 
following factors: First, the branching factor of the graph may not be
uniform across the search space. Second, some depth buckets could be
exhausted, as is depicted in the line by $[f,h,\fifo]$ which
shows all nodes in the shallower depths are expanded and the line can be below $D-d$.

Next, \refig{fig:depth-histogram4} shows the same results on the standard IPC
Openstacks and Cybersec domains.
The result in Openstacks was similar to those of the zerocost domains.
In Cybersec,
% while the depth has improved the overall performance,
we found that the performance improvement was not due to the number of nodes in $\plateau{f^*,0}$ because it was small\footnote{This does not contradict to the results in \refig{fig:plateau} because \refig{fig:plateau} uses a modified Fast Downward which continues the search until expanding all nodes in the final plateau, while in this experiment the planner immediately stops the search after the first solution. These figures are supposed to serve the different experimental purposes: \refig{fig:plateau} was intended to show the size of the entire final plateau, while \refig{fig:depth-histogram} to \refig{fig:depth-histogram4} was meant to show the actual search behavior. If we were to continue the search after the first solution, all tiebreaking strategies should result in the same figure because they expands the same set of nodes.} according to the plot.
Instead, we observed a large difference in the depth distribution in $\plateau{f^*,1}$ caused by the difference of tiebreaking (\refig{fig:depth-histogram5}), which shows that the depth can also enhance the search in non-final plateaus to find the nodes in the next plateau.
Similar phenomena were observed in several domains (which are included in \refig{fig:depth-histogram5}).\todo{if it's only ``several'', might as well say which domains instead of having the reader figure it out. Similarly, throughout this subsection and elsewhere, consider giving more specific info (domain names, or number of domains) whenever words like ``some/several/various'' are used}


\begin{figure}[htbp]
% \includegraphics{img/output-lmcut/ged-opt14-strips/p17.pdf}
\includegraphics{img/output-lmcut/depot-fuel/p07.pdf}
\includegraphics{img/output-lmcut/driverlog-fuel/p04.pdf}
\includegraphics{img/output-lmcut/elevators-up/p09.pdf}
\includegraphics{img/output-lmcut/freecell-move/p04.pdf}
\includegraphics{img/output-lmcut/gripper-move/p07.pdf}
\includegraphics{img/output-lmcut/logistics00-fuel/p016.pdf}
 \caption{(Page 1/4) Number of nodes ($y$-axis) expanded per depth ($x$-axis) in
 the final plateau with different tiebreakings. Both axes are in logarithmic scale.
 }
 \label{fig:depth-histogram}
\end{figure}

\begin{figure}[htbp]
\includegraphics{img/output-lmcut/miconic-up/p79.pdf}
\includegraphics{img/output-lmcut/pathways-fuel/p03.pdf}
\includegraphics{img/output-lmcut/pipesnt-pushstart/p06.pdf}
\includegraphics{img/output-lmcut/pipesworld-pushend/p06.pdf}
\includegraphics{img/output-lmcut/psr-small-open/p46.pdf}
\includegraphics{img/output-lmcut/rovers-fuel/p07.pdf}
 \caption{(Page 2/4) Number of nodes ($y$-axis) expanded per depth ($x$-axis) in
 the final plateau with different tiebreakings. Both axes are in logarithmic scale.
 }
 \label{fig:depth-histogram2}
\end{figure}

\begin{figure}[htbp]
\includegraphics{img/output-lmcut/scanalyzer-analyze/p04.pdf}
\includegraphics{img/output-lmcut/storage-lift/p11.pdf}
\includegraphics{img/output-lmcut/tidybot-motion/p16.pdf}
\includegraphics{img/output-lmcut/tpp-fuel/p08.pdf}
\includegraphics{img/output-lmcut/woodworking-cut/p04.pdf}
\includegraphics{img/output-lmcut/zenotravel-fuel/p07.pdf}
 \caption{(Page 3/4) Number of nodes ($y$-axis) expanded per depth ($x$-axis) in
 the final plateau with different tiebreakings. Both axes are in logarithmic scale.
 }
 \label{fig:depth-histogram3}
\end{figure}

\begin{figure}[htbp]
\includegraphics{img/output-lmcut/openstacks-opt11-strips/p07.pdf}
\includegraphics{img/output-lmcut/cybersec/p11.pdf}
 \caption{(Page 4/4) Depth distribution in the final plateau ($\plateau{f^*,0}$).}
 \label{fig:depth-histogram4}
\end{figure}

\begin{figure}[htbp]
\includegraphics{img/output-lmcut1/cybersec/p11.pdf}
\includegraphics{img/output-lmcut1/depot-fuel/p07.pdf}
\includegraphics{img/output-lmcut1/driverlog-fuel/p04.pdf}
\includegraphics{img/output-lmcut1/zenotravel-fuel/p07.pdf}
 \caption{Depth distribution in a non-final plateau ($\plateau{f^*,1}$).}
 \label{fig:depth-histogram5}
\end{figure}

